local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")

-- Create the ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "SampleGui"
screenGui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")
screenGui.ResetOnSpawn = false

-- Create the main frame
local mainFrame = Instance.new("Frame")
mainFrame.BackgroundColor3 = Color3.fromRGB(128, 128, 128)
mainFrame.BackgroundTransparency = 0.5
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -75)
mainFrame.Size = UDim2.new(0, 300, 0, 200)
mainFrame.Parent = screenGui

-- Create UI corner and stroke for main frame
local uiCorner = Instance.new("UICorner")
uiCorner.CornerRadius = UDim.new(0, 15)
uiCorner.Parent = mainFrame

local uiStroke = Instance.new("UIStroke")
uiStroke.Color = Color3.fromRGB(255, 255, 255)
uiStroke.Thickness = 2
uiStroke.Parent = mainFrame

-- Create the tab container
local tabContainer = Instance.new("Frame")
tabContainer.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
tabContainer.BackgroundTransparency = 0.5
tabContainer.Size = UDim2.new(1, 0, 0, 40)
tabContainer.Position = UDim2.new(0, 0, 0, 0)
tabContainer.Parent = mainFrame

local tabCorner = Instance.new("UICorner")
tabCorner.CornerRadius = UDim.new(0, 15)
tabCorner.Parent = tabContainer

-- Create tab buttons
local function createTabButton(name, position)
    local button = Instance.new("TextButton")
    button.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    button.BackgroundTransparency = 1
    button.Position = position
    button.Size = UDim2.new(0, 100, 0, 40)
    button.Font = Enum.Font.SourceSans
    button.Text = name
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 18
    button.TextStrokeTransparency = 0
    button.Parent = tabContainer
    return button
end

local collectButton = createTabButton("Collect", UDim2.new(0, 0, 0, 0))
local blatantButton = createTabButton("Blatant", UDim2.new(0, 100, 0, 0))

-- Create the Collect frame
local collectFrame = Instance.new("Frame")
collectFrame.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
collectFrame.BackgroundTransparency = 0.5
collectFrame.Position = UDim2.new(0, 0, 0, 40)
collectFrame.Size = UDim2.new(1, 0, 1, -40)
collectFrame.Visible = false
collectFrame.Parent = mainFrame

local collectFrameCorner = Instance.new("UICorner")
collectFrameCorner.CornerRadius = UDim.new(0, 15)
collectFrameCorner.Parent = collectFrame

-- Create buttons in Collect frame
local function createCollectButton(name, position, parent)
    local button = Instance.new("TextButton")
    button.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    button.BackgroundTransparency = 1
    button.Position = position
    button.Size = UDim2.new(0, 130, 0, 30)
    button.Font = Enum.Font.SourceSans
    button.Text = name
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 18
    button.TextStrokeTransparency = 0
    button.Parent = parent
    return button
end

local diamondButton = createCollectButton("Collect Diamonds", UDim2.new(0, 10, 0, 10), collectFrame)
local emeraldButton = createCollectButton("Collect Emeralds", UDim2.new(0, 160, 0, 10), collectFrame)
local collectAllDiamondsButton = createCollectButton("Collect All Diamonds", UDim2.new(0, 10, 0, 50), collectFrame)
local collectAllEmeraldsButton = createCollectButton("Collect All Emeralds", UDim2.new(0, 160, 0, 50), collectFrame)

-- Create the Blatant frame
local blatantFrame = Instance.new("Frame")
blatantFrame.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
blatantFrame.BackgroundTransparency = 0.5
blatantFrame.Position = UDim2.new(0, 0, 0, 40)
blatantFrame.Size = UDim2.new(1, 0, 1, -40)
blatantFrame.Visible = false
blatantFrame.Parent = mainFrame

local blatantFrameCorner = Instance.new("UICorner")
blatantFrameCorner.CornerRadius = UDim.new(0, 15)
blatantFrameCorner.Parent = blatantFrame

-- Create buttons in Blatant frame
local function createBlatantButton(name, position, parent)
    local button = Instance.new("TextButton")
    button.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    button.BackgroundTransparency = 1
    button.Position = position
    button.Size = UDim2.new(0, 130, 0, 30)
    button.Font = Enum.Font.SourceSans
    button.Text = name
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 18
    button.TextStrokeTransparency = 0
    button.Parent = parent
    return button
end

local killAuraButton = createBlatantButton("Kill Aura", UDim2.new(0, 10, 0, 10), blatantFrame)
local flyButton = createBlatantButton("Fly", UDim2.new(0, 10, 0, 50), blatantFrame)
local nukerButton = createBlatantButton("Nuker", UDim2.new(0, 10, 0, 90), blatantFrame)

-- Create the X button
local xButton = Instance.new("TextButton")
xButton.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
xButton.BackgroundTransparency = 0.5
xButton.Position = UDim2.new(1, -30, 0, 0)
xButton.Size = UDim2.new(0, 30, 0, 30)
xButton.Font = Enum.Font.SourceSans
xButton.Text = "X"
xButton.TextColor3 = Color3.fromRGB(255, 255, 255)
xButton.TextSize = 24
xButton.TextStrokeTransparency = 0
xButton.Parent = mainFrame

-- Show/Hide frames based on tab selection
collectButton.MouseButton1Click:Connect(function()
    collectFrame.Visible = true
    blatantFrame.Visible = false
end)

blatantButton.MouseButton1Click:Connect(function()
    collectFrame.Visible = false
    blatantFrame.Visible = true
end)

-- Toggle main frame visibility with X button
local function toggleMainFrameVisibility()
    mainFrame.Visible = not mainFrame.Visible
end

xButton.MouseButton1Click:Connect(toggleMainFrameVisibility)

-- Define getSwordName function
local function getSwordName()
    local itemsFolder = ReplicatedStorage:WaitForChild("Items")
    local swords = {}

    for _, v in pairs(itemsFolder:GetChildren()) do
        table.insert(swords, v.Name)
    end

    for _, sword in pairs(swords) do
        if Players.LocalPlayer.Backpack:FindFirstChild(sword) then
            return sword
        end
    end
    
    return "Wooden Sword"
end

-- Find closest player
local function findClosestPlayer(maxDistance)
    local closestPlayer = nil
    local shortestDistance = maxDistance

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= Players.LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (player.Character.HumanoidRootPart.Position - Players.LocalPlayer.Character.HumanoidRootPart.Position).magnitude
            if distance < shortestDistance then
                closestPlayer = player.Character
                shortestDistance = distance
            end
        end
    end

    return closestPlayer
end

-- Toggle Kill Aura
local killAuraEnabled = false
local killAuraConnection

local function toggleKillAura()
    killAuraEnabled = not killAuraEnabled
    killAuraButton.BackgroundColor3 = killAuraEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 0, 0)
    killAuraButton.BackgroundTransparency = killAuraEnabled and 0 or 1

    if killAuraEnabled then
        killAuraConnection = RunService.Heartbeat:Connect(function()
            if killAuraEnabled then
                local target = findClosestPlayer(18)
                if target and target:FindFirstChild("HumanoidRootPart") then
                    local swordName = getSwordName()
                    local args = {target, swordName}
                    ReplicatedStorage.Remotes.SwordAttack:FireServer(unpack(args))
                end
            end
        end)
    else
        if killAuraConnection then
            killAuraConnection:Disconnect()
        end
    end
end

killAuraButton.MouseButton1Click:Connect(toggleKillAura)

-- Toggle Fly
local flyEnabled = false

local function toggleFly()
    flyEnabled = not flyEnabled
    flyButton.BackgroundColor3 = flyEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 0, 0)
    flyButton.BackgroundTransparency = flyEnabled and 0 or 1

    if flyEnabled then
        Workspace.Gravity = 0
    else
        Workspace.Gravity = 196.2
    end
end

flyButton.MouseButton1Click:Connect(toggleFly)

-- Toggle Nuker
local nukerEnabled = false
local nukerConnection

local function toggleNuker()
    nukerEnabled = not nukerEnabled
    nukerButton.BackgroundColor3 = nukerEnabled and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(0, 0, 0)
    nukerButton.BackgroundTransparency = nukerEnabled and 0 or 1

    if nukerEnabled then
        nukerConnection = RunService.Heartbeat:Connect(function()
            if nukerEnabled then
                local closestBed = nil
                local shortestDistance = 15
                local teamColor = Players.LocalPlayer.TeamColor.Color
                
                for _, bed in pairs(Workspace.Map.Beds:GetChildren()) do
                    if bed.PrimaryPart then
                        local distance = (bed.PrimaryPart.Position - Players.LocalPlayer.Character.HumanoidRootPart.Position).magnitude
                        if distance <= shortestDistance then
                            if bed.PrimaryPart.Color ~= teamColor then
                                closestBed = bed
                                shortestDistance = distance
                            end
                        end
                    end
                end
                
                if closestBed then
                    local args = {closestBed, "Wooden Pickaxe"}
                    ReplicatedStorage.Remotes.DamageBlock:InvokeServer(unpack(args))
                end
            end
        end)
    else
        if nukerConnection then
            nukerConnection:Disconnect()
        end
    end
end

nukerButton.MouseButton1Click:Connect(toggleNuker)

-- Additional Cleanup
Players.LocalPlayer.Anticheat:Destroy()
game.StarterPlayer.StarterPlayerScripts.Anticheat:Destroy()
